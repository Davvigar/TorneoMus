<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Historial - Torneo de Mus</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<style>
		.ronda-card {
			transition: all 0.3s ease;
		}
		.ronda-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0,0,0,0.1);
		}
		.nav-buttons {
			position: sticky;
			top: 0;
			z-index: 1000;
			background: rgba(255,255,255,0.95);
			backdrop-filter: blur(10px);
			border-bottom: 1px solid #dee2e6;
			padding: 10px 0;
		}

	</style>
</head>
<body class="bg-light">
	<div class="container mt-4">
		<div class="row mb-4">
			<div class="col-12">
				<h1 class="text-center text-primary">
					<i class="fas fa-history"></i> Historial del Torneo
				</h1>
				<hr>
			</div>
		</div>

		<!-- Información de la ronda actual -->
		<div class="row mb-4">
			<div class="col-12">
				<div class="alert alert-info">
					<i class="fas fa-info-circle"></i>
					<strong>Ronda Actual:</strong> <span th:text="${rondaActual}">0</span>
					<span th:if="${historial != null and !historial.isEmpty()}">
						· <strong>Total de Rondas:</strong> <span th:text="${historial.size()}">0</span>
					</span>
				</div>
			</div>
		</div>

		<div th:if="${rondaActual == 0}" class="row mb-4">
			<div class="col-12">
				<div class="alert alert-warning text-center">
					<i class="fas fa-exclamation-triangle"></i>
					<strong>No hay rondas jugadas aún.</strong>
				</div>
			</div>
		</div>

		<!-- Navegación rápida (solo si hay muchas rondas) -->
		<div th:if="${historial != null and !historial.isEmpty() and historial.size() > 5}" class="nav-buttons">
			<div class="row">
				<div class="col-12 text-center">
					<button class="btn btn-outline-primary btn-sm me-2" onclick="scrollToTop()">
						<i class="fas fa-arrow-up"></i> Ir al Inicio
					</button>
					<button class="btn btn-outline-primary btn-sm me-2" onclick="scrollToBottom()">
						<i class="fas fa-arrow-down"></i> Ir al Final
					</button>
					<button class="btn btn-outline-info btn-sm" onclick="scrollToCurrent()">
						<i class="fas fa-crosshairs"></i> Ir a Ronda Actual
					</button>
				</div>
			</div>
		</div>



		<!-- Lista de rondas -->
		<div th:if="${historial != null and !historial.isEmpty()}" th:each="entry : ${historial}" class="row mb-3">
			<div class="col-12">
				<div class="card ronda-card" th:attr="id='ronda-' + ${entry.key}">
					<div class="card-header" th:classappend="${entry.key == rondaActual ? 'bg-primary text-white' : ''}">
						<h5>
							<i class="fas fa-gamepad"></i> 
							Ronda <span th:text="${entry.key}"></span>
							<span th:if="${entry.key == rondaActual}" class="badge bg-light text-primary ms-2">Actual</span>
						</h5>
					</div>
					<div class="card-body">
						<div th:if="${entry.value != null and !entry.value.isEmpty()}" class="row">
							<div th:each="enfrentamiento : ${entry.value}" class="col-md-6 mb-3">
								<div class="card" th:classappend="${(enfrentamiento.pareja2 == null or (enfrentamiento.pareja1 != null and enfrentamiento.pareja2 != null and enfrentamiento.pareja1.id == enfrentamiento.pareja2.id)) ? 'border-warning' : 'border-success'}">
									<div class="card-body">
										<h6 class="card-title">
											<span th:if="${enfrentamiento.pareja2 == null or (enfrentamiento.pareja1 != null and enfrentamiento.pareja2 != null and enfrentamiento.pareja1.id == enfrentamiento.pareja2.id)}">
												Quien libra · <span class="badge bg-warning text-dark" th:text="${enfrentamiento.pareja1 != null ? enfrentamiento.pareja1.nombre : '—'}"></span>
											</span>
											<span th:unless="${enfrentamiento.pareja2 == null or (enfrentamiento.pareja1 != null and enfrentamiento.pareja2 != null and enfrentamiento.pareja1.id == enfrentamiento.pareja2.id)}">
												Enfrentamiento #<span th:text="${enfrentamiento.id}"></span>
											</span>
										</h6>
										<div class="row mb-2">
											<div class="col-6">
												<span class="badge bg-primary" th:text="${enfrentamiento.pareja1 != null ? enfrentamiento.pareja1.nombre : '—'}"></span>
											</div>
											<div class="col-6">
												<span class="badge" th:classappend="${(enfrentamiento.pareja2 == null or (enfrentamiento.pareja1 != null and enfrentamiento.pareja2 != null and enfrentamiento.pareja1.id == enfrentamiento.pareja2.id)) ? 'bg-warning text-dark' : 'bg-secondary'}"
												      th:text="${(enfrentamiento.pareja2 == null or (enfrentamiento.pareja1 != null and enfrentamiento.pareja2 != null and enfrentamiento.pareja1.id == enfrentamiento.pareja2.id)) ? 'Descanso' : enfrentamiento.pareja2.nombre}"></span>
											</div>
										</div>
										<div th:if="${!(enfrentamiento.pareja2 == null or (enfrentamiento.pareja1 != null and enfrentamiento.pareja2 != null and enfrentamiento.pareja1.id == enfrentamiento.pareja2.id))}">
											<div th:if="${enfrentamiento.jugado}" class="mt-2">
												<strong>Ganador:</strong>
												<span class="badge bg-success" th:text="${enfrentamiento.ganador != null ? enfrentamiento.ganador.nombre : '—'}"></span>
											</div>
											<div th:if="${enfrentamiento.jugado}" class="mt-2">
												<strong>Perdedor:</strong>
												<span class="badge bg-danger" th:text="${enfrentamiento.getPerdedor() != null ? enfrentamiento.getPerdedor().nombre : '—'}"></span>
											</div>
											<div th:unless="${enfrentamiento.jugado}" class="mt-2">
												<a th:href="@{/resultado/{id}(id=${enfrentamiento.id})}" class="btn btn-sm btn-outline-primary">
													<i class="fas fa-edit"></i> Registrar Resultado
												</a>
											</div>
											<div th:if="${enfrentamiento.jugado}" class="mt-2">
												<a th:href="@{/resultado/{id}(id=${enfrentamiento.id})}" class="btn btn-sm btn-outline-secondary">
													<i class="fas fa-pen"></i> Editar Resultado
												</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div th:unless="${entry.value != null and !entry.value.isEmpty()}" class="text-center text-muted">
							<i class="fas fa-info-circle"></i> No hay enfrentamientos registrados para esta ronda
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Navegación -->
		<div class="row mb-4">
			<div class="col-12 text-center">
				<a th:href="@{/}" class="btn btn-primary me-2">
					<i class="fas fa-home"></i> Volver al Inicio
				</a>
				<a th:href="@{/clasificacion}" class="btn btn-info">
					<i class="fas fa-list-ol"></i> Clasificación
				</a>
			</div>
		</div>
	</div>
	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		function scrollToTop() {
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}
		
		function scrollToBottom() {
			window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
		}
		
		function scrollToCurrent() {
			const rondaActual = document.querySelector('.card-header.bg-primary');
			if (rondaActual) {
				rondaActual.scrollIntoView({ behavior: 'smooth', block: 'center' });
			}
		}
		
		// Auto-scroll suave al hacer clic en enlaces internos
		document.addEventListener('DOMContentLoaded', function() {
			const links = document.querySelectorAll('a[href^="#"]');
			links.forEach(link => {
				link.addEventListener('click', function(e) {
					e.preventDefault();
					const targetId = this.getAttribute('href').substring(1);
					const targetElement = document.getElementById(targetId);
					if (targetElement) {
						targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
					}
				});
			});
		});
	</script>
</body>
</html> 